webpackJsonp([10],{gLM1:function(e,t){},qdtB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),o=a.n(r),l={data:function(){return{loading:!0,lists:[],currentPage:1,pageSize:10,totalCount:2,databaseType:[],connectionDriver:[],tableData:[],queryForm:{title:"",type:"",url:"",diver:"",version:"",username:"",password:""},createform:{title:"",type:"",diver:"",version:"",username:"",password:""},updateform:{id:0,title:"",type:"",diver:"",version:"",username:"",password:""},rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"}],type:[{required:!0,message:"数据库类型必须选择",trigger:"change"}],url:[{required:!0,message:"Jdbc URL必须提供",trigger:"blur"}],username:[{required:!0,message:"连接账号名必须提供",trigger:"blur"}],password:[{required:!0,message:"连接密码必须提供",trigger:"blur"}]},dialogFormVisible:!1,createFormVisible:!1,updateFormVisible:!1}},methods:{loadData:function(){var e=this;this.$http({method:"GET",url:"/dbswitch/admin/api/v1/connection/list/"+this.currentPage+"/"+this.pageSize}).then(function(t){0===t.data.code?(e.currentPage=t.data.pagination.page,e.pageSize=t.data.pagination.size,e.totalCount=t.data.pagination.total,e.tableData=t.data.data):alert("加载任务列表失败:"+t.data.message)},function(){console.log("failed")})},loadDatabaseTypes:function(){var e=this;this.databaseType=[],this.$http({method:"GET",url:"/dbswitch/admin/api/v1/connection/types"}).then(function(t){0===t.data.code?e.databaseType=t.data.data:alert("加载任务列表失败:"+t.data.message)},function(){console.log("failed")})},handleClose:function(e){},handleDelete:function(e,t){var a=this;this.$confirm("此操作将此数据源ID="+t.id+"删除么, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.delete("/dbswitch/admin/api/v1/connection/delete/"+t.id).then(function(e){0===e.data.code?a.loadData():alert("删除任务失败:"+e.data.message)})})},handleMore:function(e,t){this.dialogFormVisible=!0,this.queryForm=t},handleTest:function(e,t){this.$http.get("/dbswitch/admin/api/v1/connection/test/"+t.id).then(function(e){0===e.data.code?alert("测试连接成功!"):alert("测试连接失败,"+e.data.message)})},handleCreate:function(){var e=this,t="";if(this.databaseType.length>0)for(var a=0;a<this.databaseType.length;a++)if(this.databaseType[a].type==this.createform.type){t=this.databaseType[a].driver;break}this.$refs.createform.validate(function(a){a?e.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/dbswitch/admin/api/v1/connection/create",data:o()({name:e.createform.name,type:e.createform.type,version:e.createform.version,driver:t,url:e.createform.url,username:e.createform.username,password:e.createform.password})}).then(function(t){0===t.data.code?(e.createFormVisible=!1,e.$message("添加连接信息成功"),e.createform={},e.loadData()):alert("添加连接信息失败:"+t.data.message)}):alert("请检查输入")})},selectChangedDriverVersion:function(e){var t=this;this.connectionDriver=[],this.$http.get("/dbswitch/admin/api/v1/connection/"+e+"/drivers").then(function(e){0===e.data.code?t.connectionDriver=e.data.data:(t.$message.error("查询数据库可用的驱动版本失败,"+e.data.message),t.connectionDriver=[])})},handleUpdate:function(e,t){var a=this;this.updateform=JSON.parse(o()(t)),this.$http.get("/dbswitch/admin/api/v1/connection/"+this.updateform.type+"/drivers").then(function(e){0===e.data.code?a.connectionDriver=e.data.data:(a.$message.error("查询数据库可用的驱动版本失败,"+e.data.message),a.connectionDriver=[])}),this.updateFormVisible=!0},handleSave:function(){var e=this,t="";if(this.databaseType.length>0)for(var a=0;a<this.databaseType.length;a++)if(this.databaseType[a].type==this.updateform.type){t=this.databaseType[a].driver;break}this.$refs.updateform.validate(function(a){a?e.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/dbswitch/admin/api/v1/connection/update",data:o()({id:e.updateform.id,name:e.updateform.name,type:e.updateform.type,version:e.updateform.version,driver:t,url:e.updateform.url,username:e.updateform.username,password:e.updateform.password})}).then(function(t){0===t.data.code?(e.updateFormVisible=!1,e.$message("修改连接信息成功"),e.loadData(),e.updateform={}):alert("修改连接信息失败:"+t.data.message)}):alert("请检查输入")})},handleSizeChange:function(e){this.loading=!0,this.pageSize=e,this.loadData()},handleCurrentChange:function(e){this.loading=!0,this.currentPage=e,this.loadData()}},created:function(){this.loadDatabaseTypes(),this.loadData()}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",[a("div",{staticStyle:{margin:"10px 5px"},attrs:{align:"right",width:"95%"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-document-add"},on:{click:function(t){e.createFormVisible=!0}}},[e._v("添加")])],1),e._v(" "),a("el-table",{attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:e.tableData,size:"small",border:""}},[a("el-table-column",{attrs:{prop:"id",label:"编号","min-width":"5%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"连接名称","min-width":"20%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"20%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"数据库类型","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"version",label:"驱动版本","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"url",label:"JDBC连接串","show-overflow-tooltip":"","min-width":"30%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"账号","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"30%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"success"},on:{click:function(a){return e.handleMore(t.$index,t.row)}}},[e._v("详情")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){return e.handleTest(t.$index,t.row)}}},[e._v("测试")]),e._v(" "),a("el-dropdown",{attrs:{size:"small","split-button":"",type:"primary"}},[e._v("\n            更多\n            "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(a){return a.preventDefault(),e.handleUpdate(t.$index,t.row)}}},[e._v("修改")]),e._v(" "),a("el-dropdown-item",{nativeOn:{click:function(a){return a.preventDefault(),e.handleDelete(t.$index,t.row)}}},[e._v("删除")])],1)],1)]}}])})],1),e._v(" "),a("div",{staticClass:"page",attrs:{align:"right"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10,20,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查看数据库连接信息",visible:e.dialogFormVisible,showClose:!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{model:e.queryForm,size:"mini"}},[a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"连接名称","label-width":"120px"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:!0},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"数据库类型","label-width":"120px"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:!0},model:{value:e.queryForm.type,callback:function(t){e.$set(e.queryForm,"type",t)},expression:"queryForm.type"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"数据库驱动","label-width":"120px"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:!0},model:{value:e.queryForm.driver,callback:function(t){e.$set(e.queryForm,"driver",t)},expression:"queryForm.driver"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"驱动版本号","label-width":"120px"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:!0},model:{value:e.queryForm.version,callback:function(t){e.$set(e.queryForm,"version",t)},expression:"queryForm.version"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"JDBC连接串","label-width":"120px"}},[a("el-input",{attrs:{type:"textarea",rows:6,"auto-complete":"off",readonly:!0},model:{value:e.queryForm.url,callback:function(t){e.$set(e.queryForm,"url",t)},expression:"queryForm.url"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"账号名称","label-width":"120px"}},[a("el-input",{attrs:{"auto-complete":"off",readonly:!0},model:{value:e.queryForm.username,callback:function(t){e.$set(e.queryForm,"username",t)},expression:"queryForm.username"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"连接密码","label-width":"120px"}},[a("el-input",{attrs:{type:"password","auto-complete":"off",readonly:!0},model:{value:e.queryForm.password,callback:function(t){e.$set(e.queryForm,"password",t)},expression:"queryForm.password"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("关闭")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加数据源连接信息",visible:e.createFormVisible,showClose:!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.createFormVisible=t}}},[a("el-form",{ref:"createform",attrs:{model:e.createform,size:"mini","status-icon":"",rules:e.rules}},[a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"连接名称","label-width":"120px",required:!0,prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.createform.name,callback:function(t){e.$set(e.createform,"name",t)},expression:"createform.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"数据库类型","label-width":"120px",required:!0,prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择数据库"},on:{change:e.selectChangedDriverVersion},model:{value:e.createform.type,callback:function(t){e.$set(e.createform,"type",t)},expression:"createform.type"}},e._l(e.databaseType,function(e,t){return a("el-option",{key:t,attrs:{label:e.type,value:e.type}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"驱动版本","label-width":"120px",required:!0,prop:"version"}},[a("el-select",{attrs:{placeholder:"请选择版本"},model:{value:e.createform.version,callback:function(t){e.$set(e.createform,"version",t)},expression:"createform.version"}},e._l(e.connectionDriver,function(e,t){return a("el-option",{key:t,attrs:{label:e.driverVersion,value:e.driverVersion}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"JDBC连接串","label-width":"120px",required:!0,prop:""}},[a("el-input",{attrs:{type:"textarea",rows:6,"auto-complete":"off"},model:{value:e.createform.url,callback:function(t){e.$set(e.createform,"url",t)},expression:"createform.url"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"账号名称","label-width":"120px",prop:"username"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.createform.username,callback:function(t){e.$set(e.createform,"username",t)},expression:"createform.username"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"连接密码","label-width":"120px",prop:"password"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.createform.password,callback:function(t){e.$set(e.createform,"password",t)},expression:"createform.password"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleCreate}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改数据源连接信息",visible:e.updateFormVisible,showClose:!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.updateFormVisible=t}}},[a("el-form",{ref:"updateform",attrs:{model:e.updateform,size:"mini","status-icon":"",rules:e.rules}},[a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"连接名称","label-width":"120px",required:!0,prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.updateform.name,callback:function(t){e.$set(e.updateform,"name",t)},expression:"updateform.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"数据库类型","label-width":"120px",required:!0,prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择数据库"},on:{change:e.selectChangedDriverVersion},model:{value:e.updateform.type,callback:function(t){e.$set(e.updateform,"type",t)},expression:"updateform.type"}},e._l(e.databaseType,function(e,t){return a("el-option",{key:t,attrs:{label:e.type,value:e.type}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"驱动版本","label-width":"120px",required:!0,prop:"version"}},[a("el-select",{attrs:{placeholder:"请选择版本"},model:{value:e.updateform.version,callback:function(t){e.$set(e.updateform,"version",t)},expression:"updateform.version"}},e._l(e.connectionDriver,function(e,t){return a("el-option",{key:t,attrs:{label:e.driverVersion,value:e.driverVersion}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"JDBC连接串","label-width":"120px",required:!0,prop:"url"}},[a("el-input",{attrs:{type:"textarea",rows:6,"auto-complete":"off"},model:{value:e.updateform.url,callback:function(t){e.$set(e.updateform,"url",t)},expression:"updateform.url"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"账号名称","label-width":"120px",prop:"username"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:e.updateform.username,callback:function(t){e.$set(e.updateform,"username",t)},expression:"updateform.username"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"连接密码","label-width":"120px",prop:"password"}},[a("el-input",{attrs:{type:"password","auto-complete":"off"},model:{value:e.updateform.password,callback:function(t){e.$set(e.updateform,"password",t)},expression:"updateform.password"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.updateFormVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(l,i,!1,function(e){a("gLM1")},"data-v-f8269b80",null);t.default=n.exports}});
//# sourceMappingURL=10.b9e09bc05c7d8239e93b.js.map