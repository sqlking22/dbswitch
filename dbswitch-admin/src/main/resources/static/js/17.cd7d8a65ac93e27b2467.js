webpackJsonp([17],{D0I9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("mvHQ"),i=a.n(n),l={data:function(){return{loading:!0,currentPage:1,pageSize:10,totalCount:2,tableData:[]}},methods:{loadData:function(){var t=this;this.$http({method:"GET",url:"/dbswitch/admin/api/v1/assignment/list/"+this.currentPage+"/"+this.pageSize}).then(function(e){0===e.data.code?(t.currentPage=e.data.pagination.page,t.pageSize=e.data.pagination.size,t.totalCount=e.data.pagination.total,t.tableData=e.data.data):alert("加载任务列表失败:"+e.data.message)},function(){console.log("failed")})},boolFormatPublish:function(t,e){return!0===t.isPublished?"是":"否"},stringFormatSchedule:function(t,e){return"MANUAL"==t.scheduleMode?"手动":"系统"},handleCreate:function(){this.$router.push("/task/create")},handleUpdate:function(t,e){this.$router.push({path:"/task/update",query:{id:e.id}})},handleDelete:function(t,e){var a=this;this.$confirm("此操作将此任务ID="+e.id+"删除么, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.delete("/dbswitch/admin/api/v1/assignment/delete/"+e.id).then(function(t){0===t.data.code?a.loadData():t.data.message&&alert("删除任务失败:"+t.data.message)})})},handlePublish:function(t,e){var a=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/dbswitch/admin/api/v1/assignment/deploy?ids="+e.id}).then(function(t){0===t.data.code?(a.$message("任务发布成功"),a.loadData()):t.data.message&&alert("任务发布失败,"+t.data.message)})},handleRunTask:function(t,e){var a=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/dbswitch/admin/api/v1/assignment/run",data:i()([e.id])}).then(function(t){0===t.data.code?(a.$message("手动启动执行任务成功"),a.loadData()):t.data.message&&alert("手动启动执行任务失败,"+t.data.message)})},handleRetireTask:function(t,e){var a=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/dbswitch/admin/api/v1/assignment/retire?ids="+e.id}).then(function(t){0===t.data.code?(a.$message("下线任务成功"),a.loadData()):t.data.message&&alert("下线任务失败,"+t.data.message)})},handleSizeChange:function(t){this.loading=!0,this.pageSize=t,this.loadData()},handleCurrentChange:function(t){this.loading=!0,this.currentPage=t,this.loadData()}},created:function(){this.loadData()}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",[a("div",{staticStyle:{margin:"10px 5px"},attrs:{align:"right",width:"65%"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-document-add",size:"small"},on:{click:t.handleCreate}},[t._v("添加")])],1),t._v(" "),a("el-table",{attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:t.tableData,size:"small",border:""}},[a("el-table-column",{attrs:{prop:"id",label:"编号","min-width":"8%"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":"","min-width":"30%"}}),t._v(" "),a("el-table-column",{attrs:{prop:"scheduleMode",label:"调度",formatter:t.stringFormatSchedule,"min-width":"8%"}}),t._v(" "),a("el-table-column",{attrs:{prop:"isPublished",label:"已发布",formatter:t.boolFormatPublish,"show-overflow-tooltip":!0,"min-width":"8%"}}),t._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"时间","min-width":"15%"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"40%"},scopedSlots:t._u([{key:"default",fn:function(e){return[!1===e.row.isPublished?a("el-button",{attrs:{size:"small",type:"success"},on:{click:function(a){return t.handlePublish(e.$index,e.row)}}},[a("i",{staticClass:"el-icon-timer el-icon--right"}),t._v("发布")]):t._e(),t._v(" "),!0===e.row.isPublished?a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){return t.handleRetireTask(e.$index,e.row)}}},[a("i",{staticClass:"el-icon-delete-location el-icon--right"}),t._v("下线")]):t._e(),t._v(" "),!0===e.row.isPublished?a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){return t.handleRunTask(e.$index,e.row)}}},[a("i",{staticClass:"el-icon-video-play el-icon--right"}),t._v("执行")]):t._e(),t._v(" "),a("el-dropdown",{attrs:{size:"small","split-button":"",type:"primary"}},[t._v("\n            更多\n            "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(a){return a.preventDefault(),t.handleUpdate(e.$index,e.row)}}},[t._v("修改")]),t._v(" "),a("el-dropdown-item",{nativeOn:{click:function(a){return a.preventDefault(),t.handleDelete(e.$index,e.row)}}},[t._v("删除")])],1)],1)]}}])})],1),t._v(" "),a("div",{staticClass:"page",attrs:{align:"right"}},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[5,10,20,40],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalCount},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)},staticRenderFns:[]};var s=a("VU/8")(l,o,!1,function(t){a("XeAW")},"data-v-240c1cce",null);e.default=s.exports},XeAW:function(t,e){}});
//# sourceMappingURL=17.cd7d8a65ac93e27b2467.js.map